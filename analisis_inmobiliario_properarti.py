# -*- coding: utf-8 -*-
"""Analisis Inmobiliario - Properarti.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1THMQjni-6_htvzyDB8AZ4SiDTD0w8xUR

## **ENCABEZADO**

![properarti.png](data:image/png;base64,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)

**Analisis del Mercado Inmobiliario en CABA**.

Se pretendió realizar un EDA del Mercado Inmobiliario de CABA a partir de los datos públicos generados y publicados por PROPERARTI.

Se procedió a trabajar con los datos de propiedades en venta, tanto en pesos como en dolares, en los distintos barrios de la Capital Federal.

En primera instancia se procedió a hacer un análiis exploratorio para tener una mayor comprensión de los datos: renombrar columnas, identificar y eliminar valores nulos.

Seguidamente se avanzo en visualizaciones sencillas que permiten tener un acercamiento visual de los datos.

Finalmente se procedió a la geolocalizacion de las propiedades en oferta.

## **PAQUETES INSTALADOS**
"""

pip install --upgrade plotly

import numpy as np
import pandas as pd
import plotly.express as px
import matplotlib.pyplot as plt
import plotly.graph_objects as go
import seaborn as sns

"""## **ANALISIS EXPLORATORIO DE DATOS**"""

properarti = pd.read_csv('/content/drive/MyDrive/DATOS/GCBA/Vivienda/ar_properties.csv')
properarti.head(2)

properarti.columns

properarti.operation_type.unique()

properarti.property_type.unique()

properarti.currency.unique()

properarti.iloc[:,8].unique()   ## RENAME COLUMN 'l2' ????  PROVINCIAS

properarti.iloc[:,7].unique()   ## RENAME COLUMN 'l1' ???? PAISES

properarti.info()

properarti.head(1)

z = properarti.loc[properarti.l2 == 'Capital Federal']  # Filtro para quedarme con propiedades en CABA
z.property_type.value_counts(ascending=False)

z = z.loc[z.property_type.isin(['Departamento', 'Casa','PH'])]   # Filtro para quedarme con tres tipos de propiedades
z = z.reset_index(drop=True)
z

z.operation_type.value_counts()

z.property_type.value_counts()

z.l3.value_counts()

z.info()             ## TENGO VALORES NULOS EN LAT/LONG, PRICE

z.rename(columns={'l3':'barrio'},inplace=True)

z.head(2)

## EN ESTE PUNTO DEFINO QUEDARME CON ALGUNAS COLUMNAS: start_date, end_date, lat, lon, l3, price, currency, property_type, operation_type

columnas = ['start_date', 'end_date', 'lat', 'lon', 'barrio', 'price', 'currency', 'property_type', 'operation_type']

caba =z.loc[:,columnas]
caba

caba.info()  ## cambiar a datetime

caba['start_date']=pd.to_datetime(caba['start_date'])

caba['end_date']=pd.to_datetime(caba['end_date'])  ## tira error. quizas no hace falta el dato. REVISAR VALORES

caba.info()

caba['year']=caba['start_date'].dt.year        ## separé la fecha para poder luego analizar
caba['month']=caba['start_date'].dt.month
caba['day']=caba['start_date'].dt.day

caba['year']=caba['year'].astype(object)      ## cambio el tipo de dato
caba['month']=caba['month'].astype(object)
caba['day']=caba['day'].astype(object)

pd.options.display.float_format = '{:.2f}'.format

caba

caba.info()

plt.figure(figsize=(20,5))
fig_1 = sns.countplot (data= caba,
             x='property_type',
             hue = 'operation_type',
             orientation = 'vertical',
             dodge=False,                    ## sirve para apilar y no barras separadas por variable
             alpha=0.8
                      )
fig_1

caba = caba.loc[~caba.barrio.isna()]    ## Hay 1538 filas que no tienen el dato del barrio. Se decide eliminarlos
caba

caba.info()  ## tengo valores nulos en price y currency que tengo que eliminar para poder hacer el grafico

caba1 = caba.loc[~caba.price.isna()]    
caba1 = caba1.loc[~caba1.currency.isna()]
caba1.info()

caba1.head(2)

fig_2 = sns.barplot(data = caba1,
            x='property_type', 
            y='price', 
            hue='currency')

fig_2

px.histogram(data_frame= caba1,
           x='barrio',
           y='price',
           color = "property_type", 
           color_discrete_map={"Departamento":"#fbd306","PH":"#009ee2","Casa":"#000000"},
           nbins = 30,
           title = 'Histograma',
           labels = {'price': 'Precio', 'barrio': 'Barrio'}           )

g1 = caba.groupby(['year','property_type','barrio', 'operation_type','currency'], as_index=False)['price'].mean().sort_values(by='price', ascending=False)
g1 = g1.reset_index(drop=True)
g1.head()

z = g1.loc[(g1.operation_type == 'Venta')]
z = z.loc[(z.currency == 'ARS')]
z.head()

fig = px.scatter(data_frame= z, 
           x='price', 
           y='barrio', 
           color='property_type',
           title = 'Valor de venta por tipo de propiedad - expresado en Pesos',
           labels = {'barrio': 'Barrios', 'price':'Precio'})
fig

fig1 = px.bar(data_frame = z,
            x = z['barrio'],
            y = z['price'],
            color = z['property_type'],
            facet_col = z['year'],
            title = 'Precio de venta expresado en Pesos por Barrio - Años 2020 a 2021',
            labels = {'price' : 'Precio' , 'barrio' : 'Barrio'}
        )
fig1.update_layout(
    showlegend = False,
    title = {"x":0.5,#centrar
             "y":0.9,#bajar
             "font":{"size":20, "color": "grey"}
             }  
)
plt.show()
fig1

fig5 = px.bar(data_frame = z,
            x = y['barrio'],
            y = y['price'],
            color = y['year'],
            facet_col = y['property_type'],
            title = 'Precio de venta expresado en Pesos por Barrio - Años 2020 a 2021',
            labels = {'price' : 'Precio' , 'barrio' : 'Barrio'}
        )
fig5.update_layout(
    showlegend = False,
    title = {"x":0.5,#centrar
             "y":0.9,#bajar
             "font":{"size":20, "color": "grey"}
             }  
)
plt.show()
fig5

z.reset_index(drop=True)
w = z.loc[z.year==2021].head(25)       # CREO UN NUEVO DF CON LAS 25 PROPIEDADES DE MAYOR PRECIO DE VENTA EN DOLARES
w

fig7=px.line(data_frame=w,
        x='barrio',
        y='price',
        color= 'property_type',
        labels = {'barrio':'Barrio', 'precio_prom':'Precio promedio de Venta'},
        title = '6 propiedades en venta en Pesos por Barrio - Año 2021')
fig7

y = g1.loc[(g1.operation_type == 'Venta')]
y = y.loc[(y.currency == 'USD')]
y.head()

fig2 = px.scatter(data_frame= y, 
           x='price', 
           y='barrio', 
           color='property_type',
           title = 'Valor de venta por tipo de propiedad - expresado en Dolares',
           labels = {'barrio': 'Barrios', 'price':'Precio'})
fig2

fig3 = px.bar(data_frame = y,
            x = y['barrio'],
            y = y['price'],
            color = y['property_type'],
            facet_col = y['year'],
            title = 'Precio de venta expresado en Dolares por Barrio - Años 2020 a 2021',
            labels = {'price' : 'Precio' , 'barrio' : 'Barrio'}
        )
fig3.update_layout(
    showlegend = False,
    title = {"x":0.5,#centrar
             "y":0.9,#bajar
             "font":{"size":20, "color": "grey"}
             }  
)
plt.show()
fig3

fig4 = px.bar(data_frame = y,
            x = y['barrio'],
            y = y['price'],
            color = y['year'],
            facet_col = y['property_type'],
            title = 'Precio de venta expresado en Dolares por Barrio - Años 2020 a 2021',
            labels = {'price' : 'Precio' , 'barrio' : 'Barrio'}
        )
fig4.update_layout(
    showlegend = False,
    title = {"x":0.5,#centrar
             "y":0.9,#bajar
             "font":{"size":20, "color": "grey"}
             }  
)
plt.show()
fig4

y.reset_index(drop=True)
x = y.loc[y.year==2021].head(25)       # CREO UN NUEVO DF CON LAS 25 PROPIEDADES DE MAYOR PRECIO DE VENTA EN DOLARES
x.head(1)

fig6=px.line(data_frame=x,
        x='barrio',
        y='price',
        color= 'property_type',
        labels = {'barrio':'Barrio', 'precio_prom':'Precio promedio de Venta'},
        title = 'Top 25 propiedades en venta en dolares por Barrio - Año 2021')
fig6

"""## **MAPAS**"""

import folium

caba1.head(2)

caba1 = caba.loc[~caba.price.isna()]    
caba1 = caba1.loc[~caba1.currency.isna()]
caba1.info()

#caba_mapa = caba1.loc[~caba1.lat.isna()]
caba_mapa = caba_mapa.loc[~caba_mapa.lon.isna()]
caba_mapa.info()        ## ELIMINO VALORES NULOS DE COORDENADAS PARA PODER MAPEAR

caba_mapa.shape[0]

caba_mapa.lat.unique()

latitud = 0
longitud = 0

m = folium.Map(location= [latitud, longitud], zoom_start=7)
for i in range(0,caba_mapa.shape[0]):
  latitud = caba_mapa.loc [i,'lat']
  longitud = caba_mapa.loc [i,'lon']
  folium.Marker(location= [latitud, longitud]).add_to(m)
m

latitud = 0
longitud = 0

m = folium.Map(location= [latitud, longitud], zoom_start=4)
for i in range(0,caba_mapa.shape[0]):
  lat = caba_mapa.loc [i,'lat']
  lon = caba_mapa.loc [i,'lon']
  precio = caba_mapa.loc [i,'price']
  tipo = caba_mapa.loc [i,'property_type']

  popup_ = 'precio: ' + str(precio) +' , tipo:' + tipo

  cat_ = caba_mapa.loc[i,'property_type']
  if cat_== 'Departamento':
     folium.Marker(location= [lat, lon],
                popup=popup_,
                icon = folium.Icon(color = 'purple', icon='tag')
                ).add_to(m)
  else: 
    folium.Marker(location= [lat, lon],
                popup=popup_,
                icon = folium.Icon(color = 'blue', icon='cloud')
                ).add_to(m)

  folium.CircleMarker(location=[lat, lon], radius = precio, fill=True, fill_color='red').add_to(m)
m





